import{u as b}from"./formatoFH.CMS0xWzF.js";import"./hoisted.ll0w3Ecl.js";let I=[],m=[];function y(){const r=document.getElementById("proveedor");fetch("http://localhost:8080/proveedores").then(t=>t.json()).then(t=>{t.forEach(a=>{const s=document.createElement("option");s.value=a.idproveedores,s.textContent=a.nombre,r.appendChild(s)})}).catch(t=>{console.error("Error al obtener los proveedores:",t)})}function h(){const r=document.getElementById("cuentaz");fetch("http://localhost:8080/cuentas").then(t=>t.json()).then(t=>{I=t,t.forEach(a=>{const s=document.createElement("option");s.value=a.codigo,s.textContent=`${a.codigo} - ${a.nombre}`,s.dataset.encargado=a.codigo,r.appendChild(s)})}).catch(t=>{console.error("Error al obtener las cuentas:",t)})}document.addEventListener("DOMContentLoaded",()=>{y(),h(),document.querySelectorAll("#monto, #impuesto, #descuento").forEach(d=>{d.addEventListener("input",r)});function r(){const d=parseFloat(document.getElementById("monto").value)||0,o=parseFloat(document.getElementById("impuesto").value)||0,c=parseFloat(document.getElementById("descuento").value)||0,n=d*(o/100),e=d*(c/100),l=d+n-e,p=document.getElementById("proveedor"),g=p.options[p.selectedIndex]?.text||"N/A",i=document.getElementById("tablaFacturas");i.innerHTML="";const E=document.createElement("tr");E.innerHTML=`
            <td class="border p-2">${g}</td>
            <td class="border p-2">$${d.toFixed(2)}</td>
            <td class="border p-2">$${n.toFixed(2)}</td>
            <td class="border p-2">$${e.toFixed(2)}</td>
            <td class="border p-2">$${l.toFixed(2)}</td>
        `,i.appendChild(E);const v=document.getElementById("totalCompras");v.textContent=`$${l.toFixed(2)}`}document.getElementById("agregarCuentas").addEventListener("click",()=>{const d=document.getElementById("tipo").value,o=document.getElementById("cuentaz").value,c=parseFloat(document.getElementById("valor").value)||0;if(o&&c){const n=I.find(e=>e.codigo===o);n?(m.push({tipo:d,cuenta:n,valor:c}),t(),document.getElementById("valor").value=""):console.error("Cuenta no encontrada:",o)}});function t(){const d=document.getElementById("cuentasSeleccionadas");d.innerHTML="",m.forEach((o,c)=>{const n=document.createElement("li");n.textContent=`${o.tipo} - ${o.cuenta.codigo} - ${o.cuenta.nombre}: $${o.valor.toFixed(2)}`;const e=document.createElement("img");e.src="../../public/img/black/trash.svg",e.className="px-2 py-1 ml-2 click",e.addEventListener("click",()=>a(c)),n.appendChild(e),d.appendChild(n)})}function a(d){m.splice(d,1),t()}document.getElementById("contabilizar").addEventListener("click",()=>{document.getElementById("proveedor").value,parseFloat(document.getElementById("monto").value),parseFloat(document.getElementById("impuesto").value),parseFloat(document.getElementById("descuento").value);let o=0,c=0;m.forEach(e=>{const l=document.createElement("tr");l.innerHTML=`
                  <td class="border p-2">${e.cuenta.codigo} - ${e.cuenta.nombre}</td>
                  <td class="border p-2">${e.tipo==="debito"?`$${e.valor.toFixed(2)}`:""}</td>
                  <td class="border p-2">${e.tipo==="credito"?`$${e.valor.toFixed(2)}`:""}</td>
              `,tablaContabilidad.appendChild(l),e.tipo==="debito"?o+=e.valor:e.tipo==="credito"&&(c+=e.valor)}),document.getElementById("totalDebitos").textContent=`$${o.toFixed(2)}`,document.getElementById("totalCreditos").textContent=`$${c.toFixed(2)}`;const n=document.getElementById("validacionSaldos");o===c?(n.textContent="Los saldos están equilibrados.",n.className="text-green-500"):(n.textContent="Los saldos NO están equilibrados.",n.className="text-red-500")}),document.getElementById("registrar").addEventListener("click",()=>{const o=document.getElementById("proveedor").value,c=parseFloat(document.getElementById("monto").value)||0,n=parseFloat(document.getElementById("impuesto").value)||0,e=parseFloat(document.getElementById("descuento").value)||0,l=document.getElementById("fecha").textContent,p=document.getElementById("hora").textContent,g=c*(n/100),i=c*(e/100),E=c+g-i,v=localStorage.getItem("userId"),B=document.getElementById("registroCodigo"),C=Number(B.value);fetch("http://localhost:8080/insertComprasDet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({monto:c,montoImpuesto:g,montoDescuento:i,totalCalculado:E,idProveedorSeleccionado:o,cuentasSeleccionadas:m,fecha:l,hora:p,userId:v,codeFactura:C})}).then(u=>u.json()).then(u=>{u.success?(document.getElementById("successModal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("successModal").classList.add("hidden"),s()},5e3)):(document.getElementById("errorModal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("errorModal").classList.add("hidden")},5e3))}).catch(u=>{console.error("Error al enviar los datos:",u),document.getElementById("errorModal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("errorModal").classList.add("hidden")},5e3)})});function s(){document.getElementById("monto").value="",document.getElementById("impuesto").value="",document.getElementById("descuento").value="",m=[],t(),r()}document.getElementById("registrar").addEventListener("click",()=>{document.getElementById("successModal").classList.add("hidden")}),document.getElementById("registrar").addEventListener("click",()=>{document.getElementById("errorModal").classList.add("hidden")})});document.addEventListener("DOMContentLoaded",()=>{b()});y();h();
