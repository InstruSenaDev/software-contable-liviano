function d(){try{localStorage.removeItem("email"),s("modal-success"),setTimeout(()=>{window.location.href="/"},3e3)}catch{s("modal-error")}}function s(o){const e=document.getElementById(o);if(!e){console.error(`No se encontró un elemento con el ID: ${o}`);return}e.classList.remove("hidden"),e.classList.add("opacity-100"),setTimeout(()=>{e.classList.add("opacity-0"),e.classList.remove("opacity-100"),setTimeout(()=>{e.classList.add("hidden")},100)},2e3)}const c=()=>{document.getElementById("modal").classList.remove("hidden")},i=()=>{document.getElementById("modal").classList.add("hidden")};document.getElementById("openModalButton").addEventListener("click",c);document.getElementById("closeModalButton").addEventListener("click",i);document.getElementById("logoutButton").addEventListener("click",d);document.addEventListener("DOMContentLoaded",function(){const o=localStorage.getItem("email");o?m(o):l()});function m(o){fetch(`http://localhost:8080/usuariosLog?email=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}).then(e=>{if(!e.ok)throw new Error("Error al guardar el email en el servidor");return e.json()}).then(e=>{console.log("Email enviado y guardado:",e),u(o)}).catch(e=>{console.error("Hubo un problema al guardar el email:",e)})}function u(o){fetch(`http://localhost:8080/usuariosLog?email=${o}`,{method:"GET"}).then(e=>{if(!e.ok)throw new Error("Error al recibir la información del servidor");return e.json()}).then(e=>{if(e.length>0){const t=e[0],n=`${t.nombre}`,r=t.idusuario;localStorage.setItem("userId",r),E(n)}else l()}).catch(e=>{console.error("Hubo un problema con la solicitud:",e)})}function E(o){const e=document.getElementById("user_name");e&&(e.textContent=o);const t=document.getElementById("user_names");t&&(t.textContent=o);const n=document.getElementById("user_namexz");n&&(n.textContent=o);const r=document.getElementById("user_namex");r&&(r.textContent=o);const a=document.getElementById("modal_user_name");a&&(a.textContent=o)}function l(){const o=document.getElementById("user_name");o&&(o.textContent="Usuario desconocido");const e=document.getElementById("user_names");e&&(e.textContent="Usuario desconocido");const t=document.getElementById("user_namexz");t&&(t.textContent="Usuario desconocido");const n=document.getElementById("user_namex");n&&(n.textContent="Usuario desconocido");const r=document.getElementById("modal_user_name");r&&(r.textContent="Usuario desconocido")}async function g(){try{const o=localStorage.getItem("email");if(!o){console.error("No hay ningún correo almacenado en localStorage.");return}const e=await fetch(`http://localhost:8080/usuariosLog?email=${encodeURIComponent(o)}`),t=await e.json();if(e.ok){const n=t[0];n?(console.log("Rol del usuario:",n.idrol),n.idrol===1?document.getElementById("btnAdmins").parentElement.classList.remove("hidden"):document.getElementById("btnAdmins").parentElement.classList.add("hidden")):console.error("No se encontró el usuario en la respuesta.")}else console.error("Error al obtener el rol del usuario:",t.error||t.message)}catch(o){console.error("Error al realizar la solicitud de rol de usuario:",o)}}document.addEventListener("DOMContentLoaded",g);
