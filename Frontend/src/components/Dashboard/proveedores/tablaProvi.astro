---
import ProviderRow from "./dataProvi.astro";

// Realiza el fetch a tu endpoint
const fetchData = async () => {
  try {
    const response = await fetch('http://localhost:8080/proveedores'); // Ajusta la URL según sea necesario
    if (!response.ok) throw new Error('Network response was not ok');
    const data = await response.json();
    console.log(data); // Muestra los datos en la consola
    return data;
  } catch (error) {
    console.error('Error al obtener los datos:', error);
    return [];
  }
};

// Función para convertir el tipo de documento a su descripción
const getDocumentType = (type) => {
  switch(type) {
    case 1:
      return "Cédula";
    case 2:
      return "NIT";
    default:
      return "Desconocido";
  }
};

// Obtén la lista de proveedores
const providers = await fetchData();
---

<h1 class="font-bold text-3xl flex justify-center">Proveedores</h1>

<div class="flex flex-row space-x-2 justify-between m-3">
  <div class="flex items-center space-x-2 md:space-x-4">
    <input
      class="h-8 w-48 md:w-96 rounded-md text-sm"
      type="text"
      placeholder="Buscar..."
    />
  </div>
  <div class="flex flex-row">
    <div
      class="flex flex-row p-1 bg-blue-baby4 text-white rounded-md font-display hover:bg-blue-baby3"
    >
      <img
        class="m-1"
        src="../../../public/img/white/register-shopping.svg"
        alt=""
      />
    <a href="/rProviders">
      <button>Registrar proveedores</button>

    </a>
    </div>
    <div class="p-2 hover:border border-red-700 rounded-sm">
      <img class="" src="../../../public/img/black/trash.svg" alt="" />
    </div>
  </div>
</div>

<table class="min-w-full bg-white border border-gray-200">
  <thead>
    <tr class="border-b text-justify">
      <th class="p-2">Nombre</th>
      <th class="p-2">Encargado</th>
      <th class="p-2">Numero.Doc</th>
      <th class="p-2">Tipo documento</th>
      <th class="p-2">Telefono</th>
      <th class="p-2">Correo</th>
      <th class="p-2">Dirección</th>
    </tr>
  </thead>

  <tbody>
    {providers.map((provider) => (
      <ProviderRow
        name={provider.nombre}
        encargado={provider.encargado}
        nit={provider.numerodocumento}
        tipeDocument={getDocumentType(provider.iddocumento)}
        email={provider.correoelectronico}
        telefono={provider.numerotelefono}
        address={provider.direccion}
      />
    ))}
  </tbody>
</table>
